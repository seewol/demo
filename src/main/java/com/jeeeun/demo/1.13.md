## 1.13 (클린 아키텍처)

### 계층별 DTO 역할 정리

- **Request (Controller 계층)**
  - 웹 요청 DTO
  - Validation 담당
  - 웹 계층 책임만 가짐


- **Command (Service 입력 모델)** 
  - Controller → Service DTO 넘길 때 (~Command)
  - Request → Service 전달용 DTO
  - `Request.toCommand()`로 변환


- **Application / model 패키지**
  - Service 계층에서 사용하는 DTO 위치
  - `Command` / `Result` 포함
  - 웹과 도메인 사이 경계 역할


- **Result (Service 결과 출력 모델)**
  - Service → Controller 결과 반환 (~Result)
  - Service 로직 수행 결과
  - 비즈니스 의미 중심의 데이터
  - 웹 응답 형식과 분리
  - `Entity → Result` 변환은 `Result` 에서 `static from(Entity)`로 처리


- **Response (Controller 계층)**
  - 클라이언트로 내려주는 응답 DTO
  - `Response.from(Result)`로 변환
  - API 스펙에 맞게 구성해야 함.


- `Record` 문법 활용


---
#### Request → Command → Service → Result → Response

``` shell
    Controller
      ↓
    MemberCreateRequest   (웹 요청 DTO, Validation 담당)
      ↓ toCommand()
    MemberCreateCommand   (Application 계층 입력 모델)
      ↓
    Service
      ↓
    MemberCreateResult    (Application 결과 모델)
      ↓
    MemberCreateResponse  (웹 응답 DTO)
```
---
### Command 작성 예
```java
    @Builder
public record MemberCreateCommand (
        String name,
        String email,
        String password,
        String phoneNumber
) {}
```
``` java
    /*
      인스턴스 메서드
      Request → Command 변환
      - Controller → Service 경계용
      - Validation 통과 후 호출되는 것을 전제로 함
     */
    public MemberCreateCommand toCommand() {
        return MemberCreateCommand.builder()
                .name(name)
                .email(email)
                .password(password)
                .phoneNumber(phoneNumber)
                .build();
    }
```
---
### Result 작성 및 변환 흐름
```shell
  Entity
    ↓ (Service 계층)
  Result.from(Entity)
  
  Result
    ↓ (Controller 계층)
  Response.from(Result)  
```
- Entity → Result 변환은 `Result`에서 `from(Entity)`로 처리
- Result → Response 변환은 `Response`에서 `from(Result)`로 처리
```shell
Entity → Result → Response
     from       from
```

``` java
    @Builder
    public record MemberCreateResult (
        Integer id,
        String name,
        String email,
        String phoneNumber,
        LocalDateTime createdAt,
        LocalDateTime updatedAt
    
    ) {}
```
```java
    /*
      Static 메서드
      Result → Response 변환에 사용
      - Response 는 Result 를 "생성 재료"로만 사용
     */
    public static MemberCreateResponse from(MemberCreateResult result) {
    return MemberCreateResponse.builder()
            .id(result.id())
            .name(result.name())
            .email(result.email())
            .phoneNumber(result.phoneNumber())
            .createdAt(result.createdAt())
            .updatedAt(result.updatedAt())
            .build();
}
```

---
