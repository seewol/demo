## JWT
JWT란?
JSON Web Token은 당사자 간에 정보를 안전하게 전송하기 위한 개방형 표준(RFC 7519)입니다.eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4ifQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c특징

Self-contained: 토큰 자체에 필요한 모든 정보 포함
Stateless: 서버가 세션을 저장할 필요 없음
URL-safe: Base64URL 인코딩으로 URL에서 안전하게 사용

## JWT 구조 
JWT는 점(.)으로 구분된 세 부분으로 구성됩니다.
``` json
Header.Payload.Signature
```

### Header (헤더)
토큰 타입과 서명 알고리즘 정보
``` json
   json {
       "alg": "HS256",    // 서명 알고리즘
       "typ": "JWT"       // 토큰 타입
       }
```

### Payload (페이로드)
실제 전달할 데이터 (Claims)
``` json
{
       "sub": "1234567890",     // Subject (주체)
       "name": "John Doe",      // 사용자 정의 데이터
       "iat": 1516239022,       // Issued At (발급 시간)
       "exp": 1516242622        // Expiration (만료 시간)
}
```
### Signature (서명)
토큰의 무결성을 검증하는 서명
``` json 
HMACSHA256(
       base64UrlEncode(header) + "." + base64UrlEncode(payload),
       secret
   )
```

3. Claims (클레임) 종류
Registered Claims (등록된 클레임)
JWT 표준에서 정의한 예약어
| 클레임  | 이름 | 설명 | 
|-------|-----|-----|
| iss | Issuer | 토큰 발급자 |
| sub | Subject | 토큰 주체 (보통 사용자 ID) |
| aud | Audience | 토큰 대상자 |
| exp | Expiration | 만료 시간 (Unix timestamp) |
| nbf | Not Before | 토큰 활성화 시간 |
| iat | Issued At | 발급 시간 |
| jti | JWT ID | 토큰 고유 식별자 |


**왜 직접 구현하면 안 되는가?**

| 직접 구현의 문제 | 라이브러리 사용 시 이점 |
|-----------------|----------------------|
| 서명 검증 로직 누락 가능 | 검증된 보안 로직 |
| Base64 인코딩 실수 | 표준 준수 (RFC 7519) |
| 타이밍 공격 취약점 | 보안 패치 자동 적용 |
| 알고리즘 혼동 공격 | 알고리즘 강제 지정 |

### JWT 구조
```
Header.Payload.Signature

Header: {"alg": "HS256", "typ": "JWT"}
Payload: {"sub": "1234", "exp": 1234567890, ...}
Signature: HMACSHA256(base64(header) + "." + base64(payload), secret)
```


## 5. Access Token vs Refresh Token

### 개념
```
┌─────────────────────────────────────────────────────────────┐
│                      인증 흐름                               │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [로그인] ──→ Access Token (30분) + Refresh Token (7일)     │
│                    │                       │                │
│                    ▼                       │                │
│  [API 요청] ←── Access Token 사용          │                │
│                    │                       │                │
│                    ▼                       │                │
│  [만료됨] ──→ Refresh Token으로 재발급 ◄───┘                │
│                    │                                        │
│                    ▼                                        │
│  [새 Access Token] ──→ 계속 사용                            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 비교

| 구분 | Access Token | Refresh Token |
|------|--------------|---------------|
| **목적** | API 인증 | Access Token 재발급 |
| **수명** | 짧음 (15분~1시간) | 김 (7일~30일) |
| **저장 위치** | 메모리, 변수 | HttpOnly Cookie, 안전한 저장소 |
| **포함 정보** | 사용자 정보, 권한 | 최소 정보 (사용자 ID) |
| **탈취 시 위험** | 낮음 (짧은 수명) | 높음 (긴 수명) |

### 왜 두 개를 사용하는가?
```
보안과 사용성의 균형:

1. Access Token만 사용 (긴 수명)
   - 편리하지만 탈취 시 오래 악용됨
   
2. Access Token만 사용 (짧은 수명)  
   - 안전하지만 자주 로그인해야 함
   
3. Access + Refresh Token ✓
   - Access: 짧은 수명으로 탈취 피해 최소화
   - Refresh: 긴 수명으로 사용자 편의성 유지
   - Refresh 탈취 시 서버에서 무효화 가능
```


### 토큰 관리 전략

- Access Token: 짧은 수명 (15분~1시간)
- Refresh Token: 긴 수명 (7일~30일), DB 저장
- 토큰 블랙리스트: 로그아웃 시 무효화


## 6. JWT vs Session

### 비교

| 구분 | JWT (Token) | Session |
|------|-------------|---------|
| **저장 위치** | 클라이언트 | 서버 |
| **서버 상태** | Stateless | Stateful |
| **확장성** | 높음 (서버 추가 용이) | 낮음 (세션 공유 필요) |
| **보안** | 토큰 탈취 위험 | 세션 하이재킹 위험 |
| **무효화** | 어려움 (만료까지 유효) | 쉬움 (서버에서 삭제) |
| **데이터 크기** | 큼 (Payload 포함) | 작음 (Session ID만) |

### 언제 무엇을 사용?
```
JWT 적합:
- MSA (Microservice Architecture)
- 모바일 앱
- 여러 도메인/서비스 간 인증
- 서버 확장이 빈번한 경우

Session 적합:
- 단일 서버
- 즉시 세션 무효화가 중요한 경우
- 민감한 금융 서비스
- 전통적인 웹 애플리케이션
```

## 7. JWT 보안 취약점과 대응

### 주요 취약점

| 취약점 | 설명 | 대응 방안 |
|-------|------|----------|
| **토큰 탈취** | XSS, 네트워크 스니핑 | HTTPS 필수, HttpOnly Cookie, 짧은 수명 |
| **알고리즘 혼동** | `alg: none` 공격 | 알고리즘 명시적 지정, 검증 라이브러리 사용 |
| **비밀키 노출** | 소스코드 노출, 약한 키 | 환경변수 관리, 충분히 긴 키 (256bit+) |
| **만료 미검증** | exp 클레임 무시 | 항상 만료 시간 검증 |
| **Replay 공격** | 탈취한 토큰 재사용 | jti로 토큰 식별, 짧은 수명 |

### 보안 체크리스트
```
✅ HTTPS 사용
✅ 256bit 이상의 비밀키
✅ 짧은 Access Token 수명 (15분~1시간)
✅ Refresh Token Rotation
✅ 민감한 정보 Payload에 포함 금지
✅ 알고리즘 명시적 지정
✅ 토큰 블랙리스트 (필요시)
✅ HttpOnly, Secure, SameSite 쿠키 속성


### 숙제
1. 전체 오류 해결하기
2. JWT 토큰 로직 작성하기 -> 토큰 눈으로 확인
3. 로그인 로직 완성해보기
4. JWT 마크다운 설명 이해될때까지 반복읽어보기 **